---
- hosts: all
  sudo: yes
  tasks:
    - name: ensure apt cache is the latest
      apt: update_cache=yes upgrade=yes cache_valid_time=86400

- hosts: web
  sudo: yes
  roles:
    - apache

- hosts: db
  sudo: yes
  vars:
    postgresql_postgis: true
    postgresql_listen_addresses: '*'
    postgresql_authentication:
      - type: host
        user: drupal
        method: md5
        database: drupal
        address: '192.168.0.0/24'
  roles:
    - zenoamaro.postgresql
    - memcache

- hosts: web
  roles:
    - drupal7
